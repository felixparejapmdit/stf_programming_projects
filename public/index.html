<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>STF Programming Projects</title>
    <!-- Swiper CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <link rel="stylesheet" href="/css/index.css" />
  </head>
  <body>
    <header>
      <!-- Video Greeting Section -->
      <div class="video-greeting">
        <!-- Thumbnail Image for the Video -->
        <img
          src=""
          alt="Video Thumbnail"
          id="greetingVideoThumbnail"
          onclick="openFullScreen()"
          class="responsive-thumbnail"
        />
      </div>

      <div
        class="header-text"
        style="
          width: 70%;
          flex: 1;
          display: flex;
          flex-direction: column;
          justify-content: center;
        "
      >
        <!-- Ensuring header text takes 70% width -->
        <h1
          style="
            font-size: 2.5rem;
            margin-bottom: 1em;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            word-wrap: break-word;
          "
        >
          Thank you po, Kapatid na Eduardo V. Manalo!
        </h1>
        <p
          style="
            font-size: 1.2rem;
            line-height: 1.6;
            font-weight: 300;
            opacity: 0.8;
            word-wrap: break-word;
            text-align: center;
          "
        >
          We humbly present po the websites and applications that our team has
          developed.
        </p>
      </div>
    </header>

    <!-- Fullscreen Video Modal -->
    <div id="videoModal">
      <video id="fullscreenVideo" controls>
        <source src="sample.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </div>

    <!-- Controls Section -->
    <div class="controls">
      <input
        type="text"
        id="searchInput"
        placeholder="Search projects..."
        oninput="filterProjects()"
      />
      <select id="sortSelect" onchange="filterProjects()">
        <option value="az">Sort A–Z</option>
        <option value="za">Sort Z–A</option>
      </select>

      <!-- View Icons -->
      <i class="fa fa-th-large" onclick="setView('grid')" title="Grid View"></i>
      <i class="fa fa-list" onclick="setView('list')" title="List View"></i>
      <i
        class="fa fa-images"
        onclick="setView('carousel')"
        title="Carousel View"
      ></i>
    </div>

    <!-- Project Container -->
    <div class="container grid" id="projectContainer"></div>

    <div class="carousel-wrapper">
      <div
        class="swiper-container"
        id="carouselContainer"
        style="display: none"
      >
        <div class="swiper-wrapper"></div>
        <div class="swiper-pagination"></div>
      </div>
    </div>

    <footer class="site-footer">
      <p>
        Thank you po for all the guidance and support. We will continue to work
        diligently and use this office to develop more applications that will
        help in the Church Administration's projects po. Thank you so much po
        for your love and care for all of us, we love you so much po.
      </p>
      <p>- STF Programming Team</p>
    </footer>

    <script>
      let projects = [];
      let currentView = "grid";
      let searchText = "";
      let sortOrder = "az";

      // Fetch projects
      fetch("/api/projects")
        .then((res) => res.json())
        .then((data) => {
          // Exclude the "admin" project
          projects = data.filter((project) => project.name !== "admin");
          filterProjects();
        });

      // View switch
      function setView(view) {
        currentView = view;

        const container = document.getElementById("projectContainer");
        const carousel = document.getElementById("carouselContainer");

        if (view === "carousel") {
          container.style.display = "none";
          carousel.style.display = "block";
        } else {
          container.style.display = "grid";
          carousel.style.display = "none";
          container.className = `container ${view}`;
        }

        filterProjects();
      }

      // Filter projects
      function filterProjects() {
        searchText = document.getElementById("searchInput").value.toLowerCase();
        sortOrder = document.getElementById("sortSelect").value;

        let filtered = projects.filter(
          (p) =>
            p.name.toLowerCase().includes(searchText) ||
            (p.description && p.description.toLowerCase().includes(searchText))
        );

        filtered.sort((a, b) => {
          return sortOrder === "az"
            ? a.name.localeCompare(b.name)
            : b.name.localeCompare(a.name);
        });

        renderProjects(filtered);
      }

      function setSort(order) {
        sortOrder = order; // make sure this updates the main variable
        filterProjects();
      }

      // Render filtered projects
      function renderProjects(data) {
        const container = document.getElementById("projectContainer");
        const carouselWrapper = document.querySelector(".swiper-wrapper");


        data.forEach((project) => {
          const devs = project.developers
            .map(
              (dev) => `
      <div>
        <strong>${dev.name}</strong><br />
        <em style="font-size: 0.9em; color: #666;">(${dev.section})</em>
      </div>
    `
            )
            .join("");

          // CARD for grid/list
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
      <img src="${
        project.image || "https://dummyimage.com/300x150/000/fff"
      }" alt="${project.name}">
      <div>
        <h3>${project.name}</h3>
        <p>${project.description || "No description available."}</p>
        <div class="developers"><strong>Developers:</strong><br>${devs}</div>
        ${
          project.url
            ? `<a href="${project.url}" target="_blank">Open App</a>`
            : "<em>Coming soon</em>"
        }
      </div>
    `;
          container.appendChild(card);

          // SLIDE for carousel
          const slide = document.createElement("div");
          slide.className = "swiper-slide";
          slide.innerHTML = `
  <div>
    <img src="${
      project.image || "https://dummyimage.com/300x150/000/fff"
    }" alt="${project.name}" />
    <h3 style="margin-top: 10px;">${project.name}</h3>
    <p>${project.description || "No description available."}</p>
    <div class="developers" style="text-align:left">${devs}</div>
    ${
      project.url
        ? `<a href="${project.url}" target="_blank">Open App</a>`
        : "<em>Coming soon</em>"
    }
  </div>
`;

          carouselWrapper.appendChild(slide);
        });

        // Animate cards
        document.querySelectorAll(".card").forEach((card, i) => {
          setTimeout(() => card.classList.add("show"), i * 100);
        });

        // Initialize or update Swiper
        if (currentView === "carousel") {
          new Swiper(".swiper-container", {
            loop: true,
            spaceBetween: 20,
            pagination: {
              el: ".swiper-pagination",
              clickable: true,
            },
            breakpoints: {
              // when window width is >= 320px
              320: {
                slidesPerView: 1,
              },
              // when window width is >= 640px
              640: {
                slidesPerView: 2,
              },
              // when window width is >= 1024px
              1024: {
                slidesPerView: 3,
              },
            },
          });
        }

// Reset layout
container.className = "container"; // reset base
carouselWrapper.classList.remove("center-align");

// Apply view-specific layout
if (currentView === "list") {
  container.classList.add("list", "left-align");
} else if (currentView === "grid") {
  container.classList.add("grid", "center-align");
} else if (currentView === "carousel") {
  carouselWrapper.classList.add("center-align");
}


      }

      // Open the fullscreen video modal
      function openFullScreen() {
        const modal = document.getElementById("videoModal");
        const video = document.getElementById("fullscreenVideo");

        modal.classList.add("open");
  video.currentTime = 0; // optional: restart from beginning
  video.play(); // Only play when clicked
      }

      // Close the fullscreen video modal
      document.getElementById("videoModal").onclick = function (e) {
        if (e.target === this) {
          this.classList.remove("open");
            const video = document.getElementById("fullscreenVideo");
    video.pause();
    video.currentTime = 0;
        }
      };

      window.addEventListener("DOMContentLoaded", () => {
        fetch("/api/projects")
          .then((res) => res.json())
          .then((projects) => {
            const adminProject = projects.find((p) => p.name === "admin");

            if (adminProject) {
              // Set thumbnail image
              const thumbnail = document.getElementById(
                "greetingVideoThumbnail"
              );
              if (adminProject.image) {
                thumbnail.src = adminProject.image;
              }

              // Set video source
              const videoSource = document.querySelector(
                "#fullscreenVideo source"
              );
              if (adminProject.video) {
                videoSource.src = adminProject.video;
                // Load the new source
                document.getElementById("fullscreenVideo").load();
              }
            }
          })
          .catch((err) => {
            console.error("Failed to load admin project data:", err);
          });
      });

        document.addEventListener("keydown", function (e) {
    if (e.ctrlKey && e.key === "0") {
      e.preventDefault(); // Prevent browser's default zoom reset
      window.location.href = "/manage.html";
    }
  });
    </script>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  </body>
</html>
