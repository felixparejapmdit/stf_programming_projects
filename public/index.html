<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>STF Programming Projects</title>
    <!-- Swiper CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <link rel="stylesheet" href="/css/index.css" />
  </head>
  <body>
    <header class="hero-header">
      <div class="video-greeting">
        <video id="greetingVideo" class="responsive-thumbnail" muted controls>
          <source src="sample.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </div>

      <div class="header-text">
        <h1>Thank you po, Kapatid na Eduardo V. Manalo!</h1>
        <p>
          We humbly present po the websites and applications that our team has
          developed.
        </p>
      </div>
    </header>

    <!-- Controls Section -->
    <div class="controls">
      <input
        type="text"
        id="searchInput"
        placeholder="Search projects..."
        oninput="filterProjects()"
      />
      <select id="sortSelect" onchange="filterProjects()">
        <option value="az">Sort A–Z</option>
        <option value="za">Sort Z–A</option>
      </select>

      <!-- View Icons -->
      <i class="fa fa-th-large" onclick="setView('grid')" title="Grid View"></i>
      <i class="fa fa-list" onclick="setView('list')" title="List View"></i>
      <i
        class="fa fa-images"
        onclick="setView('carousel')"
        title="Carousel View"
      ></i>
    </div>

    <!-- Project Container -->
    <div class="container grid" id="projectContainer"></div>

    <div class="carousel-wrapper">
      <div
        class="swiper-container"
        id="carouselContainer"
        style="display: none"
      >
        <div class="swiper-wrapper"></div>
        <div class="swiper-pagination"></div>
      </div>
    </div>

    <div
      id="soundPrompt"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 9999;
        font-family: sans-serif;
        cursor: pointer;
      "
    >
      <p style="font-size: 1.2rem; margin-bottom: 1rem; text-align: center">
        Tap to enable sound and play video
      </p>
    </div>

    <footer class="site-footer">
      <p>
        Thank you po for all the guidance and support. We will continue to work
        diligently and use this office to develop more applications that will
        help in the Church Administration's projects po. Thank you so much po
        for your love and care for all of us, we love you so much po.
      </p>
      <p>- STF Programming Team</p>
    </footer>

    <script>
      let projects = [];
      let currentView = "grid";
      let searchText = "";
      let sortOrder = "az";
      let hasVideoPlayed = false; // Declare this globally
      // Fetch projects
      fetch("/api/projects")
        .then((res) => res.json())
        .then((data) => {
          // Exclude the "admin" project
          projects = data.filter((project) => project.name !== "admin");
          filterProjects();
        });

      // View switch
      function setView(view) {
        currentView = view;

        const container = document.getElementById("projectContainer");
        const carousel = document.getElementById("carouselContainer");

        if (view === "carousel") {
          container.style.display = "none";
          carousel.style.display = "block";
        } else {
          container.style.display = "grid";
          carousel.style.display = "none";
          container.className = `container ${view}`;
        }

        filterProjects();
      }

      // Filter projects
      function filterProjects() {
        searchText = document.getElementById("searchInput").value.toLowerCase();
        sortOrder = document.getElementById("sortSelect").value;

        let filtered = projects.filter(
          (p) =>
            p.name.toLowerCase().includes(searchText) ||
            (p.description && p.description.toLowerCase().includes(searchText))
        );

        filtered.sort((a, b) => {
          return sortOrder === "az"
            ? a.name.localeCompare(b.name)
            : b.name.localeCompare(a.name);
        });

        renderProjects(filtered);
      }

      function setSort(order) {
        sortOrder = order; // make sure this updates the main variable
        filterProjects();
      }

      function renderProjects(data) {
        const container = document.getElementById("projectContainer");
        const carouselWrapper = document.querySelector(".swiper-wrapper");

        container.innerHTML = "";
        carouselWrapper.innerHTML = "";

        data.forEach((project) => {
          const devs = project.developers
            .map(
              (dev) => `
      <div>
        <strong>${dev.name}</strong><br />
        <em style="font-size: 0.9em; color: #fff;">(${dev.section})</em>
      </div>
    `
            )
            .join("");

          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
  <img src="${
    project.image || "https://dummyimage.com/300x150/000/fff"
  }" alt="${project.name}">
  <div class="card-overlay"></div>
  <div class="card-content">
    <h3>${project.name}</h3>
    <p>${project.description || "No description available."}</p>
  </div>
  ${
    project.url
      ? `<a class="card-button" href="${project.url}" target="_blank" aria-label="Open App">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link">
              <path d="M18 13v5a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h5"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" x2="21" y1="14" y2="3"></line>
            </svg>
         </a>`
      : ""
  }
  <div class="developers-hover"><strong>Developers:</strong><br>${devs}</div>
`;
          container.appendChild(card);

          // SLIDE (Carousel)
          const slide = document.createElement("div");
          slide.className = "swiper-slide";
          slide.innerHTML = `
      <div class="card">
        <img src="${
          project.image || "https://dummyimage.com/300x150/000/fff"
        }" alt="${project.name}" />
        <div class="card-overlay"></div>

        <div class="card-content">
          <h3>${project.name}</h3>
          <p>${project.description || "No description available."}</p>
        </div>
        ${
          project.url
            ? `<a href="${project.url}" target="_blank" class="card-button" aria-label="Open App">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link">
                <path d="M18 13v5a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h5"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" x2="21" y1="14" y2="3"></line>
              </svg>
           </a>`
            : ""
        }
        <div class="developers-hover">
          <strong>Developers:</strong><br>${devs}
        </div>
      </div>
    `;
          carouselWrapper.appendChild(slide);
        });

        document.querySelectorAll(".card").forEach((card, i) => {
          setTimeout(() => card.classList.add("show"), i * 10);
        });

        if (currentView === "carousel") {
          new Swiper(".swiper-container", {
            loop: true,
            spaceBetween: 20,
            pagination: {
              el: ".swiper-pagination",
              clickable: true,
            },
            breakpoints: {
              320: { slidesPerView: 1 },
              640: { slidesPerView: 2 },
              1024: { slidesPerView: 3 },
            },
          });
        }

        container.className = "container";
        carouselWrapper.classList.remove("center-align");

        if (currentView === "list") {
          container.classList.add("list", "left-align");
        } else if (currentView === "grid") {
          container.classList.add("grid", "center-align");
        } else if (currentView === "carousel") {
          carouselWrapper.classList.add("center-align");
        }
      }

      window.addEventListener("DOMContentLoaded", () => {
        const greetingVideo = document.getElementById("greetingVideo");
        const soundPrompt = document.getElementById("soundPrompt");

        // Load admin video if available
        fetch("/api/projects")
          .then((res) => res.json())
          .then((projects) => {
            const adminProject = projects.find((p) => p.name === "admin");

            if (adminProject && greetingVideo) {
              const videoSource = greetingVideo.querySelector("source");
              if (adminProject.video) {
                videoSource.src = adminProject.video;
                greetingVideo.load();
              }
            }
          })
          .catch((err) => {
            console.error("Failed to load admin project data:", err);
          });

        // Wait for user interaction to play the video
        if (soundPrompt && greetingVideo) {
          soundPrompt.style.display = "flex";

          soundPrompt.addEventListener("click", () => {
            greetingVideo.muted = false;
            greetingVideo.play();
            soundPrompt.style.display = "none";
          });
        }
      });

      document.addEventListener("keydown", function (e) {
        if (e.ctrlKey && e.key === "0") {
          e.preventDefault(); // Prevent browser's default zoom reset
          window.location.href = "/manage.html";
        }
      });
    </script>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  </body>
</html>
