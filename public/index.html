<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>STF Programming Projects</title>
    <!-- Swiper CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <style>
      body {
        margin: 0;
        font-family: sans-serif;
        background: linear-gradient(
          to bottom right,
          #ffffff,
          #ffffff
        ); /* Light blue-gray gradient */
        color: #333;
      }

      body,
      html {
        overflow-x: hidden;
      }

      /* Header styles */
      header {
        background: linear-gradient(to right, #35424a, #45a049);
        padding: 4em 2em;
        text-align: left;
        color: white;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        transition: background 0.3s ease-in-out, transform 0.3s ease-in-out;
        margin-top: 3em;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        flex-wrap: nowrap;
      }

      /* Updated h1 styles */
      header h1 {
        font-size: clamp(1.5rem, 2.5vw, 3rem); /* Responsive font size */
        margin-bottom: 1em;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-weight: 700;
        transition: transform 0.3s ease;
        max-width: 100%;
        white-space: normal; /* ✅ allow text to wrap */
        word-wrap: break-word; /* ✅ break long words */
        overflow: visible; /* ✅ no clipping */
        text-overflow: unset; /* ✅ prevent ellipsis */
      }

      header h1:hover {
        transform: scale(1.05);
      }

      header p {
        font-size: 1.2rem;
        line-height: 1.6;
        max-width: 80%;
        margin: 0;
        font-weight: 300;
        opacity: 0.8;
        white-space: normal;
        word-wrap: break-word;
      }

      header:hover {
        background: linear-gradient(to right, #45a049, #35424a);
        transform: translateY(-10px);
      }

      @media (max-width: 768px) {
        header {
          flex-direction: column;
          text-align: center;
          align-items: center;
        }

        header h1 {
          font-size: clamp(1.2rem, 5vw, 2.5rem); /* Adjusts nicely on mobile */
        }

        header p {
          font-size: 1rem;
        }
      }

      .video-greeting {
        text-align: center;
        margin-bottom: 20px;
        position: relative;
        flex: 1;
        cursor: pointer;
        margin-right: 50px;
        width: 30%;
        min-width: 200px; /* Optional: ensures it doesn’t get too narrow */
      }

      .video-greeting img {
        width: 100%;
        height: auto;
        max-height: 400px; /* Keeps image height consistent */
        object-fit: cover; /* Ensures image is nicely cropped if needed */
        cursor: pointer;
        border-radius: 8px;
        transition: transform 0.3s ease-in-out;
      }

      .video-greeting img:hover {
        transform: scale(1.05);
      }
      /* Fullscreen Modal Styles */
      #videoModal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      #videoModal video {
        width: 80%;
        height: auto;
        max-height: 90%;
      }

      #videoModal.open {
        display: flex;
      }

      /* Controls */
      .controls {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin: 20px;
      }

      .controls input,
      .controls select,
      .controls i {
        padding: 8px 12px;
        font-size: 16px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }

      .controls i {
        cursor: pointer;
        font-size: 24px;
        color: #35424a;
      }

      .controls i:hover {
        color: #45a049;
      }

      .controls input[type="text"] {
        padding: 10px 16px;
        font-size: 16px;
        border: 2px solid #ccc;
        border-radius: 6px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      }

      .controls input[type="text"]:focus {
        border-color: #45a049;
        box-shadow: 0 0 6px rgba(69, 160, 73, 0.5);
        outline: none;
      }

      /* Card Section */
      .container.grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 20px;
        padding: 20px;
        max-width: 1200px;
        margin: auto;
      }

      .container.list {
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 20px;
        max-width: 800px;
        margin: auto;
      }

      .card {
        background: white;
        padding: 1em;
        border-radius: 10px;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        text-align: center;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease, transform 0.6s ease;
      }

      .card.show {
        opacity: 1;
        transform: translateY(0);
      }

      .list .card {
        flex-direction: row;
        text-align: left;
        align-items: center;
        gap: 20px;
      }

      .card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 5px;
      }

      .list .card img {
        width: 180px;
        height: 100px;
      }

      .card a {
        display: inline-block;
        margin-top: 10px;
        padding: 0.5em 1em;
        background: #35424a;
        color: white;
        text-decoration: none;
        border-radius: 5px;
      }

      .card a:hover {
        background: #45a049;
      }

      /* Ensure carousel container has space for pagination below */
      .swiper-container {
        padding-bottom: 70px;
        max-width: 1200px;
        margin: auto;
        position: relative;
      }

      /* Ensure each slide fills height and aligns content */
      .swiper-wrapper {
        align-items: stretch;
      }

      .swiper-slide {
        display: flex;
        height: auto; /* allow content to dictate height */
      }

      /* Style the inner card for consistent layout and equal height */
      .swiper-slide > div {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        width: 100%;
        height: 100%;
      }

      /* Image styling */
      .swiper-slide img {
        width: 100%;
        height: 160px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      /* Open App button style */
      .swiper-slide a {
        display: inline-block;
        margin-top: 15px;
        padding: 10px 16px;
        background-color: #35424a;
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-weight: bold;
        text-align: center;
        transition: background 0.3s;
      }

      .swiper-slide a:hover {
        background-color: #45a049;
      }

      /* Correct swiper pagination positioning */
      .swiper-pagination {
        position: absolute;
        bottom: 10px;
        width: 100%;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <header>
      <!-- Video Greeting Section -->
      <div class="video-greeting">
        <!-- Thumbnail Image for the Video -->
        <img
          src=""
          alt="Video Thumbnail"
          id="greetingVideoThumbnail"
          onclick="openFullScreen()"
          class="responsive-thumbnail"
        />
      </div>

      <div
        class="header-text"
        style="
          width: 70%;
          flex: 1;
          display: flex;
          flex-direction: column;
          justify-content: center;
        "
      >
        <!-- Ensuring header text takes 70% width -->
        <h1
          style="
            font-size: 2.5rem;
            margin-bottom: 1em;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            word-wrap: break-word;
          "
        >
          Thank you po, Kapatid na Eduardo V. Manalo!
        </h1>
        <p
          style="
            font-size: 1.2rem;
            line-height: 1.6;
            font-weight: 300;
            opacity: 0.8;
            word-wrap: break-word;
          "
        >
          We humbly present po the websites and applications that our team has
          developed.
        </p>
      </div>
    </header>

    <!-- Fullscreen Video Modal -->
    <div id="videoModal">
      <video id="fullscreenVideo" controls autoplay>
        <source src="sample.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </div>

    <!-- Controls Section -->
    <div class="controls">
      <input
        type="text"
        id="searchInput"
        placeholder="Search projects..."
        oninput="filterProjects()"
      />
      <select id="sortSelect" onchange="filterProjects()">
        <option value="az">Sort A–Z</option>
        <option value="za">Sort Z–A</option>
      </select>

      <!-- View Icons -->
      <i class="fa fa-th-large" onclick="setView('grid')" title="Grid View"></i>
      <i class="fa fa-list" onclick="setView('list')" title="List View"></i>
      <i
        class="fa fa-images"
        onclick="setView('carousel')"
        title="Carousel View"
      ></i>
    </div>

    <!-- Project Container -->
    <div class="container grid" id="projectContainer"></div>

    <div class="carousel-wrapper">
      <div
        class="swiper-container"
        id="carouselContainer"
        style="display: none"
      >
        <div class="swiper-wrapper"></div>
        <div class="swiper-pagination"></div>
      </div>
    </div>

    <script>
      let projects = [];
      let currentView = "grid";
      let searchText = "";
      let sortOrder = "az";

      // Fetch projects
      fetch("/api/projects")
        .then((res) => res.json())
        .then((data) => {
          // Exclude the "admin" project
          projects = data.filter((project) => project.name !== "admin");
          filterProjects();
        });

      // View switch
      function setView(view) {
        currentView = view;

        const container = document.getElementById("projectContainer");
        const carousel = document.getElementById("carouselContainer");

        if (view === "carousel") {
          container.style.display = "none";
          carousel.style.display = "block";
        } else {
          container.style.display = "grid";
          carousel.style.display = "none";
          container.className = `container ${view}`;
        }

        filterProjects();
      }

      // Filter projects
      function filterProjects() {
        searchText = document.getElementById("searchInput").value.toLowerCase();
        sortOrder = document.getElementById("sortSelect").value;

        let filtered = projects.filter(
          (p) =>
            p.name.toLowerCase().includes(searchText) ||
            (p.description && p.description.toLowerCase().includes(searchText))
        );

        filtered.sort((a, b) => {
          return sortOrder === "az"
            ? a.name.localeCompare(b.name)
            : b.name.localeCompare(a.name);
        });

        renderProjects(filtered);
      }

      function setSort(order) {
        sortOrder = order; // make sure this updates the main variable
        filterProjects();
      }

      // Render filtered projects
      function renderProjects(data) {
        const container = document.getElementById("projectContainer");
        const carouselWrapper = document.querySelector(".swiper-wrapper");

        container.innerHTML = "";
        carouselWrapper.innerHTML = "";

        data.forEach((project) => {
          const devs = project.developers
            .map(
              (dev) => `
      <div style="text-align:left">
        <strong>${dev.name}</strong><br />
        <em style="font-size: 0.9em; color: #666;">(${dev.section})</em>
      </div>
    `
            )
            .join("");

          // CARD for grid/list
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
      <img src="${
        project.image || "https://dummyimage.com/300x150/000/fff"
      }" alt="${project.name}">
      <div>
        <h3>${project.name}</h3>
        <p>${project.description || "No description available."}</p>
        <div class="developers"><strong>Developers:</strong><br>${devs}</div>
        ${
          project.url
            ? `<a href="${project.url}" target="_blank">Open App</a>`
            : "<em>Coming soon</em>"
        }
      </div>
    `;
          container.appendChild(card);

          // SLIDE for carousel
          const slide = document.createElement("div");
          slide.className = "swiper-slide";
          slide.innerHTML = `
  <div>
    <img src="${
      project.image || "https://dummyimage.com/300x150/000/fff"
    }" alt="${project.name}" />
    <h3 style="margin-top: 10px;">${project.name}</h3>
    <p>${project.description || "No description available."}</p>
    <div class="developers">${devs}</div>
    ${
      project.url
        ? `<a href="${project.url}" target="_blank">Open App</a>`
        : "<em>Coming soon</em>"
    }
  </div>
`;

          carouselWrapper.appendChild(slide);
        });

        // Animate cards
        document.querySelectorAll(".card").forEach((card, i) => {
          setTimeout(() => card.classList.add("show"), i * 100);
        });

        // Initialize or update Swiper
        if (currentView === "carousel") {
          new Swiper(".swiper-container", {
            loop: true,
            spaceBetween: 20,
            pagination: {
              el: ".swiper-pagination",
              clickable: true,
            },
            breakpoints: {
              // when window width is >= 320px
              320: {
                slidesPerView: 1,
              },
              // when window width is >= 640px
              640: {
                slidesPerView: 2,
              },
              // when window width is >= 1024px
              1024: {
                slidesPerView: 3,
              },
            },
          });
        }
      }

      // Open the fullscreen video modal
      function openFullScreen() {
        const modal = document.getElementById("videoModal");
        const video = document.getElementById("fullscreenVideo");

        modal.classList.add("open");
        video.play(); // Autoplay the video
      }

      // Close the fullscreen video modal
      document.getElementById("videoModal").onclick = function (e) {
        if (e.target === this) {
          this.classList.remove("open");
        }
      };

      window.addEventListener("DOMContentLoaded", () => {
        fetch("/api/projects")
          .then((res) => res.json())
          .then((projects) => {
            const adminProject = projects.find((p) => p.name === "admin");

            if (adminProject) {
              // Set thumbnail image
              const thumbnail = document.getElementById(
                "greetingVideoThumbnail"
              );
              if (adminProject.image) {
                thumbnail.src = adminProject.image;
              }

              // Set video source
              const videoSource = document.querySelector(
                "#fullscreenVideo source"
              );
              if (adminProject.video) {
                videoSource.src = adminProject.video;
                // Load the new source
                document.getElementById("fullscreenVideo").load();
              }
            }
          })
          .catch((err) => {
            console.error("Failed to load admin project data:", err);
          });
      });
    </script>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  </body>
</html>
